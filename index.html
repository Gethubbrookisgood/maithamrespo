<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>التشفير المعوق</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@100;200;300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&display=swap');
    
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #151520;
      --bg-card: rgba(255, 255, 255, 0.04);
      --bg-card-hover: rgba(255, 255, 255, 0.06);
      --bg-input: rgba(255, 255, 255, 0.08);
      --bg-input-focus: rgba(255, 255, 255, 0.12);
      
      --accent-primary: #6366f1;
      --accent-primary-hover: #4f46e5;
      --accent-secondary: #10b981;
      --accent-secondary-hover: #059669;
      --accent-danger: #ef4444;
      
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.75);
      --text-tertiary: rgba(255, 255, 255, 0.55);
      
      --border-primary: rgba(255, 255, 255, 0.12);
      --border-focus: rgba(99, 102, 241, 0.6);
      
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
      --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.25);
      --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.3);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-2xl: 48px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Noto Sans Arabic', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      direction: rtl;
      padding: var(--spacing-lg);
      min-height: 100vh;
      line-height: 1.7;
      font-weight: 400;
    }

    /* خلفية متحركة */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 25% 75%, rgba(99, 102, 241, 0.08) 0%, transparent 60%),
        radial-gradient(circle at 75% 25%, rgba(16, 185, 129, 0.08) 0%, transparent 60%);
      pointer-events: none;
      z-index: -1;
    }

    .container {
      max-width: 950px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
      padding: var(--spacing-2xl) var(--spacing-xl);
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-primary);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
    }

    .header h1 {
      font-size: 2.8rem;
      font-weight: 700;
      margin-bottom: var(--spacing-md);
      background: linear-gradient(135deg, #ffffff 0%, var(--accent-primary) 50%, var(--accent-secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.02em;
    }

    .header .subtitle {
      font-size: 1.15rem;
      color: var(--text-secondary);
      font-weight: 400;
      max-width: 650px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .section {
      background: var(--bg-card);
      padding: var(--spacing-xl);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-lg);
      border: 1px solid var(--border-primary);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
    }

    .section:hover {
      background: var(--bg-card-hover);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .section h2 {
      font-size: 1.5rem;
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    label {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.95rem;
      letter-spacing: 0.005em;
    }

    input, textarea {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-md);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-primary);
      background: var(--bg-input);
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
      font-weight: 400;
      backdrop-filter: blur(10px);
      transition: all 0.2s ease;
      resize: none;
    }

    input::placeholder, textarea::placeholder {
      color: var(--text-tertiary);
      font-weight: 300;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--border-focus);
      background: var(--bg-input-focus);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.12), var(--shadow-glow);
      transform: translateY(-1px);
    }

    textarea {
      min-height: 120px;
      line-height: 1.6;
    }

    .button-group {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-lg);
    }

    button {
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--radius-md);
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      min-height: 54px;
      letter-spacing: 0.01em;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-primary-hover) 100%);
      color: white;
      flex: 1;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--accent-primary-hover) 0%, #3730a3 100%);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--accent-secondary) 0%, var(--accent-secondary-hover) 100%);
      color: white;
      flex: 0 0 auto;
      min-width: 150px;
      box-shadow: var(--shadow-sm);
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, var(--accent-secondary-hover) 0%, #047857 100%);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary:disabled {
      background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      opacity: 0.6;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      background: rgba(255, 255, 255, 0.02);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-primary);
      margin-top: var(--spacing-md);
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
      accent-color: var(--accent-primary);
      cursor: pointer;
    }

    .checkbox-group label {
      margin: 0;
      font-weight: 400;
      cursor: pointer;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    #debug {
      display: none;
      white-space: pre-wrap;
      overflow: auto;
      margin-top: var(--spacing-md);
      background: rgba(0, 0, 0, 0.4);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      height: 200px;
      border: 1px solid var(--border-primary);
      font-family: 'Space Mono', 'Consolas', 'Monaco', monospace;
      font-size: 0.85rem;
      line-height: 1.4;
      font-weight: 400;
    }

    .message {
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-md);
      display: none;
      align-items: center;
      gap: var(--spacing-sm);
      font-weight: 500;
      backdrop-filter: blur(10px);
    }

    .success-message {
      background: rgba(16, 185, 129, 0.12);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: var(--accent-secondary);
    }

    .error-message {
      background: rgba(239, 68, 68, 0.12);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--accent-danger);
    }

    .message .icon {
      font-size: 1.125rem;
      flex-shrink: 0;
    }

    /* تحسينات للشاشات الصغيرة */
    @media (max-width: 768px) {
      body {
        padding: var(--spacing-md);
      }
      
      .header {
        padding: var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
      }
      
      .header h1 {
        font-size: 2.2rem;
      }
      
      .header .subtitle {
        font-size: 1rem;
      }
      
      .section {
        padding: var(--spacing-lg);
      }
      
      .button-group {
        flex-direction: column;
      }

      .btn-secondary {
        min-width: auto;
      }
    }

    /* تحسينات الـ scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    /* تحسين التركيز للوصولية */
    button:focus-visible,
    input:focus-visible,
    textarea:focus-visible {
      outline: 2px solid var(--accent-primary);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🛡️ التشفير المعوق</h1>
      <p class="subtitle">سوف يتم دق العالم زيجًا</p></p>
    </div>

    <div class="section">
      <h2>⚙️ إعدادات التشفير</h2>
      <div class="form-group">
        <label>مفتاح التشفير</label>
        <input id="keyInput" value="6,12,18" placeholder="أي أرقام مفصولة بفواصل أو مسافات، مثال: 6,12,18 أو 2026 2033 2021" />
      </div>
      <div class="checkbox-group">
        <input id="addMarker" type="checkbox" checked />
        <label for="addMarker">تفعيل الحماية المتقدمة (يضمن أن النص مشفر من هذا الموقع)</label>
      </div>
      <div class="checkbox-group">
        <input id="showDebug" type="checkbox" />
        <label for="showDebug">عرض تفاصيل التشفير التقنية</label>
      </div>
      <div id="debug"></div>
    </div>

    <div class="section">
      <h2>🔒 تشفير النص</h2>
      <div class="form-group">
        <label>النص المراد تشفيره</label>
        <textarea id="plainText" rows="4" placeholder="اكتب هنا النص الذي تريد حمايته وتشفيره..."></textarea>
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="encrypt()">
          <span>🔐</span>
          <span>تشفير النص</span>
        </button>
      </div>
      <div class="form-group">
        <label>النص المشفر</label>
        <textarea id="cipherText" rows="4" readonly placeholder="سيظهر هنا النص المشفر بعد الضغط على زر التشفير..."></textarea>
      </div>
      <div class="button-group">
        <button id="copyBtn" class="btn-secondary" onclick="copyEncrypted()" disabled>
          <span>📋</span>
          <span>نسخ النص المشفر</span>
        </button>
      </div>
      <div id="encryptSuccess" class="message success-message">
        <span class="icon">✓</span>
        <span>تم التشفير بنجاح! يمكنك الآن نسخ النص المشفر ومشاركته بأمان.</span>
      </div>
    </div>

    <div class="section">
      <h2>🔓 فك التشفير</h2>
      <div class="form-group">
        <label>النص المشفر</label>
        <textarea id="cipherInput" rows="4" placeholder="الصق هنا النص المشفر الذي تريد فك تشفيره..."></textarea>
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="decrypt()">
          <span>🔓</span>
          <span>فك التشفير</span>
        </button>
      </div>
      <div class="form-group">
        <label>النص الأصلي</label>
        <textarea id="plainOutput" rows="4" readonly placeholder="سيظهر هنا النص الأصلي بعد فك التشفير بنجاح..."></textarea>
      </div>
      <div id="decryptSuccess" class="message success-message">
        <span class="icon">✓</span>
        <span>تم فك التشفير بنجاح!</span>
      </div>
      <div id="decryptError" class="message error-message">
        <span class="icon">⚠️</span>
        <span id="errorMessage">خطأ في فك التشفير</span>
      </div>
    </div>
  </div>

<script>
/* ===== قوائم + خرائط ===== */
const AR_LETTERS = ['ا','ب','ت','ث','ج','ح','خ','د','ذ','ر','ز','س','ش','ص','ض','ط','ظ','ع','غ','ف','ق','ك','ل','م','ن','ه','و','ي'];
const EN_LETTERS = 'abcdefghijklmnopqrstuvwxyz'.split('');

const encodeMapAR = {}; AR_LETTERS.forEach((c,i)=> encodeMapAR[c]=i+1);
const decodeMapAR = AR_LETTERS.slice();
const encodeMapEN = {}; EN_LETTERS.forEach((c,i)=> encodeMapEN[c]=i+1);
const decodeMapEN = EN_LETTERS.slice();

/* ===== ماركرات رقمية ===== */
const SYS_MARKER_TOKENS = ["14'","8'","21'"];         
const LANG_MARKER_TOKENS = {
  AR: ["26'","9'"],   
  EN: ["22'","13'"]   
};

/* ===== عناصر واجهة ===== */
const debugEl = document.getElementById('debug');
function dbg(...args){
  if(document.getElementById('showDebug').checked){
    debugEl.style.display = 'block';
    debugEl.textContent += args.join(' ') + '\n';
  }
}
function clearDbg(){ 
  debugEl.textContent = ''; 
  if(!document.getElementById('showDebug').checked) debugEl.style.display='none'; 
}
function showMessage(elementId, show = true) {
  document.getElementById(elementId).style.display = show ? 'flex' : 'none';
}
function hideAllMessages() {
  showMessage('encryptSuccess', false);
  showMessage('decryptSuccess', false);
  showMessage('decryptError', false);
}

/* ===== أدوات مساعدة ===== */
function parseKey(){
  const keyInput = document.getElementById('keyInput').value.trim();
  if(!keyInput) return [];
  let cleanInput = keyInput.replace(/'/g, '');
  return cleanInput
    .split(/[,\s]+/)
    .map(s => {
      const num = parseInt(s.trim(), 10);
      return isNaN(num) ? null : num;
    })
    .filter(n => n !== null);
}
function charToNum(ch, lang){
  if(lang==='AR') return encodeMapAR[ch] || null;
  if(lang==='EN') return encodeMapEN[ch.toLowerCase()] || null;
  return null;
}
function numToChar(num, lang){
  if(lang==='AR') return decodeMapAR[num-1] || '';
  if(lang==='EN') return decodeMapEN[num-1] || '';
  return '';
}

/* ===== التشفير بدون تدوير ===== */
function encryptTextToTokens(text, key, lang){
  let keyIndex = 0;
  const tokens = [];
  dbg('المفتاح المستخدم:', key.join(','));
  for(let ch of text){
    const num = charToNum(ch, lang);
    if(num){
      const k = key[keyIndex % key.length];
      const enc = num + k; // بدون % أو تدوير
      tokens.push(enc + "'");
      keyIndex++;
      dbg(`حرف: ${ch} -> رقم: ${num} + مفتاح: ${k} = ${enc}`);
    } else {
      tokens.push(ch);
    }
  }
  return tokens.join(' ');
}

/* ===== فك التشفير بدون تدوير ===== */
function decryptTokensRange(tokens, key, lang, startIndex=0, endIndex = null){
  let kIdx = 0;
  let out = '';
  const stop = (endIndex === null) ? tokens.length : endIndex;
  dbg('فك التشفير - المفتاح:', key.join(','));
  for(let i = startIndex; i < stop; i++){
    const t = tokens[i];
    if(/^\d+'$/.test(t)){
      const num = parseInt(t.replace("'", ""), 10);
      const k = key[kIdx % key.length];
      const origNum = num - k; // بدون % أو تدوير
      const char = numToChar(origNum, lang);
      out += char;
      dbg(`توكن: ${t} -> رقم: ${num} - مفتاح: ${k} = ${origNum} -> حرف: ${char}`);
      kIdx++;
    } else if(/^\s+$/.test(t)){
      const run = t.length;
      if(run >= 3){
        out += ' '.repeat(run - 2);
      }
    } else {
      out += t;
    }
  }
  return out;
}

/* ===== تشفير ===== */
function encrypt(){
  clearDbg();
  hideAllMessages();
  const plain = document.getElementById('plainText').value || '';
  const key = parseKey();
  if(key.length === 0){
    document.getElementById('errorMessage').textContent = 'يرجى إدخال مفتاح التشفير';
    showMessage('decryptError');
    return; 
  }
  if(plain.trim() === '') {
    document.getElementById('errorMessage').textContent = 'يرجى إدخال النص المراد تشفيره';
    showMessage('decryptError');
    return;
  }
  try {
    const useMarker = document.getElementById('addMarker').checked;
    const lang = /[\u0600-\u06FF]/.test(plain) ? 'AR' : 'EN';
    const encBody = encryptTextToTokens(plain, key, lang);
    let final = encBody;
    if(useMarker){

const sys = SYS_MARKER_TOKENS.join(' ');
      const langMark = LANG_MARKER_TOKENS[lang].join(' ');
      final = sys + ' ' + langMark + ' ' + encBody;
    }
    document.getElementById('cipherText').value = final;
    document.getElementById('copyBtn').disabled = false;
    showMessage('encryptSuccess');
  } catch(error) {
    document.getElementById('errorMessage').textContent = 'حدث خطأ في عملية التشفير';
    showMessage('decryptError');
  }
}

/* ===== فك التشفير ===== */
function tokenizeCipher(cipher){
  return cipher.match(/\d+'|\s+|[^\d\s]+/g) || [];
}
function matchSequenceAtStart(tokens, seq){
  let i = 0;
  for(let j = 0; j < seq.length; j++){
    while(i < tokens.length && /^\s+$/.test(tokens[i])) i++;
    if(i >= tokens.length) return -1;
    if(tokens[i] !== seq[j]) return -1;
    i++;
  }
  return i;
}
function detectNumericMarkerAtStart(tokens){
  for(const lang of ['AR','EN']){
    const sysEnd = matchSequenceAtStart(tokens, SYS_MARKER_TOKENS);
    if(sysEnd === -1) return null;
    const langSeq = LANG_MARKER_TOKENS[lang];
    const langEnd = matchSequenceAtStart(tokens.slice(sysEnd), langSeq);
    if(langEnd !== -1){
      return { lang, markerEndTokenIndex: sysEnd + langEnd };
    }
  }
  return null;
}
function decrypt(){
  clearDbg();
  hideAllMessages();
  const cipher = document.getElementById('cipherInput').value || '';
  const key = parseKey();
  if(key.length === 0){
    document.getElementById('errorMessage').textContent = 'يرجى إدخال مفتاح التشفير';
    showMessage('decryptError');
    return; 
  }
  if(cipher.trim() === '') {
    document.getElementById('errorMessage').textContent = 'يرجى إدخال النص المشفر';
    showMessage('decryptError');
    return;
  }
  try {
    const tokens = tokenizeCipher(cipher);
    let lang = /[\u0600-\u06FF]/.test(cipher) ? 'AR' : 'EN';
    const marker = detectNumericMarkerAtStart(tokens);
    let startIndex = 0;
    if(marker){
      lang = marker.lang;
      startIndex = marker.markerEndTokenIndex;
    }
    const plain = decryptTokensRange(tokens, key, lang, startIndex);
    document.getElementById('plainOutput').value = plain;
    showMessage('decryptSuccess');
  } catch(error) {
    document.getElementById('errorMessage').textContent = 'خطأ في فك التشفير';
    showMessage('decryptError');
  }
}

/* ===== نسخ النص ===== */
function copyEncrypted(){
  const cipherText = document.getElementById('cipherText');
  cipherText.select();
  document.execCommand('copy');
}
</script>
