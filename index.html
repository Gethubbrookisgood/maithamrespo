<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تشفيري — أداة التشفير الشخصية</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa6bf;--accent:#60a5fa;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Naskh Arabic',sans-serif;background:linear-gradient(180deg,#071027 0%,#081228 100%);color:#e6eef8}
    .wrap{max-width:980px;margin:32px auto;padding:20px}
    h1{font-size:20px;margin:0 0 12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    textarea,input,select{width:100%;box-sizing:border-box;border-radius:8px;padding:10px;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);color:inherit}
    textarea{min-height:100px;resize:vertical}
    .row{display:flex;gap:8px}
    button{background:var(--accent);border:none;color:#021028;padding:8px 12px;border-radius:8px;cursor:pointer}
    pre{white-space:pre-wrap;word-wrap:break-word;background:var(--glass);padding:10px;border-radius:8px;color:var(--muted);font-family:inherit}
    .small{font-size:12px;color:var(--muted)}
    .foot{margin-top:12px;font-size:13px;color:var(--muted)}
    @media(max-width:880px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>تشفيري — أداة التشفير الشخصية (تعمل بالكامل محليًا)</h1>
    <p class="small">الموقع يعمل في المتصفح فقط — لا تُرفع بيانات إلى أي خادم. افتراضيًا: يتم تحويل العربية لكتابة إنجليزية (transliteration) ثم تُحول الحروف الإنجليزية إلى أرقام بحسب ترتيب الأبجدية بالعكس ثم يُطبق مفتاح الدوران.</p>

    <div class="grid">
      <div class="card">
        <label>نص بالعربية (أو نسخ من مفكرة):</label>
        <textarea id="inputArabic" placeholder="اكتب هنا...
مثال: كتاب"></textarea>

        <div style="margin-top:8px" class="row">
          <div style="flex:1">
            <label>مفتاح الدوران (افتراضي 42):</label>
            <input id="keyInput" type="number" value="42" />
          </div>
          <div style="width:140px">
            <label>وضع التدوير (Modulo):</label>
            <select id="modToggle">
              <option value="on">شغّل (يبقي الأرقام ضمن 1..26)</option>
              <option value="off">أوقف (الأرقام قد تصبح كبيرة)</option>
            </select>
          </div>
        </div>

        <div style="margin-top:10px" class="row">
          <button id="encryptBtn">تشفير</button>
          <button id="decryptBtn">فك التشفير</button>
          <button id="clearBtn">مسح</button>
          <button id="downloadBtn">تحميل HTML</button>
        </div>

        <p class="foot">خيارات متقدمة: يمكنك تعديل جدول الـ transliteration داخل الشيفرة إن رغبت، أو استخدام زر "فك التشفير" لإرجاع النص الأصلي إن كنت تعرف المفتاح ووضع التدوير.</p>
      </div>

      <div class="card">
        <label>النتيجة — الكتابة الإنجليزية (transliteration):</label>
        <pre id="latinOut">-</pre>

        <label style="margin-top:8px">النتيجة — أرقام بعد تطبيق ترتيب الأبجدية بالعكس ثم مفتاح الدوران:</label>
        <pre id="numbersOut">-</pre>

        <label style="margin-top:8px">فك الشفرة (نص مفكوك):</label>
        <pre id="decodedOut">-</pre>
      </div>
    </div>

    <div style="margin-top:16px" class="card">
      <h3 style="margin-top:0">شرح سريع للآلية التي يعتمدها الموقع</h3>
      <ul class="small">
        <li>1) تحويل الحروف العربية لحروف إنجليزية تقريبية (مثال: "ك" → "k", "ت" → "t").</li>
        <li>2) لكل حرف لاتيني نأخذ موقعه في الأبجدية الإنجليزية (a..z -> 1..26) <strong>لكن بالعكس</strong> (a→26, b→25, c→24, ... , z→1).</li>
        <li>3) نضيف مفتاح الدوران (موجب) لكل قيمة. إن كان وضع التدوير مفعلًا، نطبّق modulo 26 بحيث تبقى النتائج بين 1 و26، وإذا كان مُطفأ فالأرقام ليست مقيدة.</li>
        <li>4) العرض النهائي بالأرقام مفصولة بعلامة "'" كما رغبت.</li>
      </ul>
    </div>
  </div>

<script>
// --- جدول تبسيطي للتحويل من العربية إلى كتابة "إنجليزية" (transliteration)
// يمكنك تعديله أو توسيعه حسب احتياجك
const arToLat = {
  'ا':'a','أ':'a','إ':'a','آ':'aa','ب':'b','ت':'t','ث':'th','ج':'j','ح':'h','خ':'kh',
  'د':'d','ذ':'dh','ر':'r','ز':'z','س':'s','ش':'sh','ص':'s','ض':'d','ط':'t','ظ':'z',
  'ع':'a','غ':'gh','ف':'f','ق':'q','ك':'k','ل':'l','م':'m','ن':'n','ه':'h','و':'w','ي':'y',
  'ى':'a','ء':'','ئ':'','ؤ':'','ة':'h','ً':'','ٌ':'','ٍ':'','َ':'','ُ':'','ِ':'','ْ':'','ّ':''
};

function transliterateArabic(text){
  let out='';
  for(let ch of text){
    if(arToLat.hasOwnProperty(ch)) out += arToLat[ch];
    else if(/\s/.test(ch)) out += ' ';
    else out += ch; // إن كان حرف لاتيني أو رقم، نحتفظ به
  }
  // نظف المسافات المكررة
  return out.replace(/\s+/g,' ').trim();
}

// دالة لتحويل حرف لاتيني مفرد إلى ترتيبه بالعكس: a->26, b->25, ..., z->1
function reversedAlphaIndex(letter){
  const a = letter.toLowerCase();
  if(a < 'a' || a > 'z') return null;
  const idx = a.charCodeAt(0) - 'a'.charCodeAt(0) + 1; // 1..26
  return 27 - idx; // بالعكس: 26..1
}

function encryptText(arabicText, key, useModulo=true){
  const latin = transliterateArabic(arabicText);
  const parts = [];
  for(let i=0;i<latin.length;i++){
    const ch = latin[i];
    if(/\s/.test(ch)) { parts.push('\n'); continue; }
    // لدعم digraphs مثل 'sh','kh','th'، نجرب التقاط ثنائي
    let two = latin.substr(i,2).toLowerCase();
    let handleTwo = false;
    let num = null;
    if(['sh','kh','th','dh','gh'].includes(two)){
      // خريطة مبسطة لبعض الثنائيات (تعطي قيمة للحرف الأول فقط هنا)
      // بدلاً من تعقيد، سنفكك الثنائي إلى حروف مفردة في التشفير الحالي.
      handleTwo = false;
    }
    num = reversedAlphaIndex(ch);
    if(num===null){
      // إن كان رقمًا أو حرفًا غير لاتيني، احتفظ به كرمز
      parts.push(ch);
    } else {
      let v = num + Number(key);
      if(useModulo){
        v = ((v - 1) % 26) + 1;
      }
      parts.push(String(v));
    }
  }
  return {latin: latin, numbers: parts};
}

function decryptNumbers(numberParts, key, useModulo=true){
  const chars = [];
  for(const p of numberParts){
    if(p==='\n'){ chars.push('\n'); continue; }
    const n = Number(p);
    if(!Number.isFinite(n) || p.trim()==='') { chars.push(p); continue; }
    let v = n - Number(key);
    if(useModulo){
      v = ((v - 1) % 26) + 1;
      if(v<=0) v += 26;
    }
    const originalIdx = 27 - v; // 1..26
    const ch = String.fromCharCode('a'.charCodeAt(0) + originalIdx - 1);
    chars.push(ch);
  }
  return chars.join('');
}

// تهيئة الأزرار
const inputArabic = document.getElementById('inputArabic');
const encryptBtn = document.getElementById('encryptBtn');
const decryptBtn = document.getElementById('decryptBtn');
const clearBtn = document.getElementById('clearBtn');
const downloadBtn = document.getElementById('downloadBtn');
const latinOut = document.getElementById('latinOut');
const numbersOut = document.getElementById('numbersOut');
const decodedOut = document.getElementById('decodedOut');
const keyInput = document.getElementById('keyInput');
const modToggle = document.getElementById('modToggle');

encryptBtn.addEventListener('click', ()=>{
  const key = Number(keyInput.value) || 0;
  const useModulo = modToggle.value === 'on';
  const res = encryptText(inputArabic.value || '', key, useModulo);
  latinOut.textContent = res.latin || '-';
  const numStr = res.numbers.map(x=> (x==='\n'?"\n": (typeof x==='string' && /\D/.test(x)? x : x + "'"))).join(' ');
  numbersOut.textContent = numStr || '-';
  decodedOut.textContent = '-';
});

decryptBtn.addEventListener('click', ()=>{
  const key = Number(keyInput.value) || 0;
  const useModulo = modToggle.value === 'on';
  const numsText = numbersOut.textContent;
  const raw = numsText.replace(/'/g,' ').replace(/\n/g,' \n ');
  const parts = raw.split(/\s+/).filter(s=>s.length>0);
  const plainLatin = decryptNumbers(parts, key, useModulo);
  decodedOut.textContent = plainLatin;
  latinOut.textContent = transliterateArabic(inputArabic.value || '');
});

clearBtn.addEventListener('click', ()=>{
  inputArabic.value='';latinOut.textContent='-';numbersOut.textContent='-';decodedOut.textContent='-';
});

downloadBtn.addEventListener('click', ()=>{
  const content = document.documentElement.outerHTML;
  const blob = new Blob([content], {type: 'text/html;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'tashfiri.html';
  a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
